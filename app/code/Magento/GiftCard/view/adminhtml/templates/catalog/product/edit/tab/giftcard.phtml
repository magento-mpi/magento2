<?php
/**
 * {license_notice}
 *
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>

<div class="entry-edit form-inline" id="giftcard_info_container">
    <div class="fieldset-wrapper collapsable-wrapper" id="giftcard_info-wrapper">
        <div class="fieldset-wrapper-title">
            <strong class="title" data-toggle="collapse" data-target="#giftcard_info-content">
                <span><?php echo __('Messaging and Lifetime') ?></span>
            </strong>
        </div>
        <div class="fieldset-wrapper-content collapse" id="giftcard_info-content">
            <fieldset class="fieldset">
                <h4 class="title"><?php echo __('Gift Card Information') ?></h4>

                <div class="field">
                    <label class="label" for="giftcard_is_redeemable">
                        <?php echo __('Treat Balance as Store Credit') ?>
                    </label>
                    <div class="control">
                        <select
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                                  id="giftcard_is_redeemable"
                                  name="<?php echo $this->getFieldPrefix() ?>[is_redeemable]"
                                  class="select">
                            <option value="1">
                                <?php echo __('Yes') ?>
                            </option>
                            <option value="0"<?php if ($this->getFieldValue('is_redeemable') == 0): ?> selected="selected"<?php endif; ?>>
                                <?php echo __('No') ?>
                            </option>
                        </select>
                        <input
                            type="hidden"
                            id="giftcard_is_redeemable_default"
                            value="<?php echo $this->getConfigValue('is_redeemable'); ?>" />
                    </div>
                    <div class="field-service" <?php echo $this->getScopeValue('[GLOBAL]') ?>>
                        <?php $_checked = ($this->getFieldValue('use_config_is_redeemable') || $this->IsNew()) ? 'checked="checked"' : '' ?>
                        <input
                            type="hidden"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_is_redeemable]"
                            value="0">
                        <input
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            type="checkbox"
                            class="checkbox"
                            id="giftcard_use_config_is_redeemable"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_is_redeemable]"
                            value="1"
                            <?php echo $_checked ?>
                            onclick="toggleValueElements(this, this.up('.field'));toggleDefault('is_redeemable');"
                            />
                        <label for="giftcard_use_config_is_redeemable" class="normal">
                            <?php echo __('Use Config Settings') ?>
                        </label>
                        <script type="text/javascript">
require(['prototype'], function(){

    toggleValueElements($('giftcard_use_config_is_redeemable'), $('giftcard_use_config_is_redeemable').up('.field'));
                        
});
</script>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="giftcard_lifetime">
                        <?php echo __('Lifetime (days)') ?>
                    </label>
                    <div class="control">
                        <input
                            type="text"
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            class="input-text validate-number"
                            id="giftcard_lifetime"
                            name="<?php echo $this->getFieldPrefix() ?>[lifetime]"
                            value="<?php echo $this->getFieldValue('lifetime')*1 ?>"/>

                        <input
                            type="hidden"
                            id="giftcard_lifetime_default"
                            value="<?php echo $this->getConfigValue('lifetime'); ?>" />
                    </div>
                    <div class="field-service" <?php echo $this->getScopeValue('[GLOBAL]') ?>>
                        <?php $_checked = ($this->getFieldValue('use_config_lifetime') || $this->IsNew()) ? 'checked="checked"' : '' ?>
                        <input
                            type="hidden"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_lifetime]"
                            value="0">
                        <input
                            type="checkbox"
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            class="checkbox"
                            id="giftcard_use_config_lifetime"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_lifetime]"
                            value="1"
                            <?php echo $_checked ?>
                            onclick="toggleValueElements(this, this.up('.field')); toggleDefault('lifetime');" />
                        <label for="giftcard_use_config_lifetime" class="normal">
                            <?php echo __('Use Config Settings') ?>
                        </label>
                        <script type="text/javascript">
require(['prototype'], function(){

    toggleValueElements($('giftcard_use_config_lifetime'), $('giftcard_use_config_lifetime').up('.field'));
                        
});
</script>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="giftcard_allow_message">
                        <?php echo __('Allow Message') ?>
                    </label>
                    <div class="control">
                        <select
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            id="giftcard_allow_message" name="<?php echo $this->getFieldPrefix() ?>[allow_message]"
                            class="select">
                            <option value="1">
                                <?php echo __('Yes') ?>
                            </option>
                            <option value="0"<?php if ($this->getFieldValue('allow_message') == 0): ?> selected="selected"<?php endif; ?>>
                                <?php echo __('No') ?>
                            </option>
                        </select>
                        <input
                            type="hidden"
                            id="giftcard_allow_message_default"
                            value="<?php echo $this->getConfigValue('allow_message'); ?>" />
                    </div>
                    <div class="field-service" <?php echo $this->getScopeValue('[STORE VIEW]') ?>>
                        <?php $_checked = ($this->getFieldValue('use_config_allow_message') || $this->IsNew()) ? 'checked="checked"' : '' ?>
                        <input
                            type="hidden"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_allow_message]"
                            value="0">
                        <input
                            type="checkbox"
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            class="checkbox"
                            id="giftcard_use_config_allow_message"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_allow_message]"
                            value="1"
                            <?php echo $_checked ?>
                            onclick="toggleValueElements(this, this.up('.field')); toggleDefault('allow_message');" />
                        <label for="giftcard_use_config_allow_message" class="normal">
                            <?php echo __('Use Config Settings') ?>
                        </label>
                        <script type="text/javascript">
require(['prototype'], function(){
    toggleValueElements($('giftcard_use_config_allow_message'), $('giftcard_use_config_allow_message').up('.field'));                    
});
</script>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="giftcard_email_template">
                        <?php echo __('Email Template') ?>
                    </label>
                    <div class="control">
                        <select
                            <?php if ($this->isReadonly()):?>disabled="disabled"<?php endif;?>
                            id="giftcard_email_template"
                            name="<?php echo $this->getFieldPrefix() ?>[email_template]"
                            class="select">

                            <?php foreach ($this->getEmailTemplates() as $_value=>$_label): ?>
                            <?php $_selected = ($this->getFieldValue('email_template') == $_value ? 'selected="selected"' : ''); ?>
                            <option value="<?php echo $_value; ?>" <?php echo $_selected; ?>><?php echo $_label; ?></option>
                            <?php endforeach; ?>
                        </select>
                        <input
                            type="hidden"
                            id="giftcard_email_template_default"
                            value="<?php echo $this->getConfigValue('email_template'); ?>" />
                    </div>
                    <div class="field-service" <?php echo $this->getScopeValue('[STORE VIEW]') ?>>
                        <?php $_checked = ($this->getFieldValue('use_config_email_template') || $this->IsNew()) ? 'checked="checked"' : '' ?>
                        <input
                            type="hidden"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_email_template]"
                            value="0">
                        <input
                            type="checkbox" <?php if ($this->isReadonly()):?>
                            disabled="disabled"<?php endif;?>
                            class="checkbox"
                            id="giftcard_use_config_email_template"
                            name="<?php echo $this->getFieldPrefix() ?>[use_config_email_template]"
                            value="1" <?php echo $_checked ?>
                            onclick="toggleValueElements(this, this.up('.field')); toggleDefault('email_template');"/>
                        <label for="giftcard_use_config_email_template" class="normal">
                            <?php echo __('Use Config Settings') ?>
                        </label>
                        <script type="text/javascript">
require(['prototype'], function(){
    toggleValueElements($('giftcard_use_config_email_template'), $('giftcard_use_config_email_template').up('.field'));
});
</script>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>

<script type="text/javascript">
require(['jquery'], function(jQuery){

    //<![CDATA[
jQuery(function($){
    window.toggleDefault = function (field)
    {
        var defaultValue = $('#giftcard_' + field + '_default').val(),
            $checkbox = $('#giftcard_use_config_' + field);
        if ($checkbox.is(':checked')) {
            $('#giftcard_' + field).val(defaultValue);
        }
    };

    var toggleOpenAmount = function () {
        $('#open_amount_min,#open_amount_max').prop('disabled', !$('#allow_open_amount').is(':checked'));
    };

    toggleDefault('email_template');
    toggleDefault('is_redeemable');
    toggleDefault('lifetime');
    toggleDefault('allow_message');

    $('#allow_open_amount').on('click', toggleOpenAmount);
    toggleOpenAmount();

    /**
     * Adding event on card type select box of product to set weight to required or not
     */
    $('[data-tab-panel=product-details]').on('move.tabs', function () {
        $('#giftcard_type').on('change', function () {
            var $weight = $('#weight');
            var isVirtual = $(this).val() == '0';
            if ($weight.length) {
                $weight.prop('disabled', isVirtual);
            }
            $.each($('.hidden-for-virtual'), function () {
                $(this).closest('.field').toggle(!isVirtual);
            });
        }).trigger('change');

        $('#weight_and_type_switcher').closest('.field').hide();
    });
});
    //]]>

});
</script>
