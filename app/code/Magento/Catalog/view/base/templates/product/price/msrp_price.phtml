<?php
/**
 * {license_notice}
 *
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php
//Template for displaying product price at product view page, gift registry and wish-list
/** @var \Magento\Catalog\Pricing\Render\PriceBox $this */
/** @var \Magento\Catalog\Pricing\Price\MsrpPriceInterface $priceType */
/** @var \Magento\Catalog\Model\Product $product */
$priceType = $this->getPrice();
$product = $this->getSaleableItem();
$productId = $product->getId();
$priceElementIdPrefix = $this->getPriceElementIdPrefix() ? : 'product-price-';
$addToCartUrl = $product->isSaleable() ? $this->helper('\Magento\Checkout\Helper\Cart')->getAddUrl($product) : '';
//@TODO: msrp works totally wrong, any excuses not accepted. will be refactored ASAP
$msrpPrice = $this->renderAmount(
    $priceType->getCustomAmount($product->getMsrp()),
    [
        'price_id' => $this->getPriceId() ? $this->getPriceId() : 'old-price-' . $productId,
        'include_container' => false,
        'skip_adjustments' => true
    ]
);
?>
<span class="old-price"><?php echo $msrpPrice ?></span>
<?php if ($priceType->isShowPriceOnGesture()): ?>
    <?php $priceElementId = $priceElementIdPrefix . $productId . $this->getIdSuffix(); ?>
    <?php $popupId = 'msrp-popup-' . $productId . $this->getRandomString(20); ?>
    <span id="<?php echo $this->getPriceId() ? : $priceElementId ?>" style="display:none"></span>
    <a href="#" id="<?php echo $popupId; ?>"
       data-mage-init='{"addToCart":{
       "popupId": "#<?php echo $popupId; ?>",
       "productName": "<?php echo $product->getName(); ?>",
       "realPrice": <?php echo $this->jsonEncode($this->getRealPriceHtml()); ?>,
       "msrpPrice": <?php echo $this->jsonEncode($msrpPrice); ?>,
       "priceElementId":"<?php echo $priceElementId ?>",
       "popupCartButtonId": "#map-popup-button",
       "closeButtonId": "#map-popup-close",
       "addToCartUrl": "<?php echo $addToCartUrl; ?>"}}'>
        <?php echo __('Click for price'); ?>
    </a>
<?php else: ?>
    <span class="msrp message"><?php echo $priceType->getMsrpPriceMessage(); ?></span>
<?php endif; ?>
<?php //if ($this->getZone() == \Magento\Framework\Pricing\Render::ZONE_ITEM_VIEW): ?>
    <?php $helpLinkId = 'msrp-help-' . $productId . $this->getRandomString(20); ?>
    <a href="#" id="<?php echo $helpLinkId; ?>" class="action show map" data-mage-init='{"addToCart":{"helpLinkId": "#<?php echo $helpLinkId; ?>","productName": "<?php echo $product->getName(); ?>","closeButtonId": "#map-popup-close"}}'>
        <span><?php echo __("What's this?"); ?></span>
    </a>
<?php //endif; ?>