<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     base_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php $_formMessage=$this->getPartialAuthorizationFormMessage(); ?>
<?php $_isPartialAuthorization=$this->isPartialAuthorization(); ?>
<?php if ($_isPartialAuthorization || $_formMessage): ?>
<div class="form-list" id="payment_form_<?php echo $this->getMethodCode() ?>_before" style="display:none;">
    <?php if ($_formMessage): ?>
    <?php echo $this->showNoticeMessage($_formMessage) ?>
    <?php endif;?>

    <?php if ($this->isPartialAuthorization()): ?>
        <?php echo $this->getChildHtml('cards') ?>
        <div class="release-amounts" data-container="release-amounts">
            <button class="button" type="button" id="payment-button-cancel" name="cancel"><span><span>Cancel</span></span></button>
            <span><?php echo __('To cancel pending authorizations and release amounts that have already been processed during this payment, click Cancel.') ?></span>
        </div>
        <?php echo $this->showNoticeMessage(__('Please enter a different credit card number to complete your purchase.')) ?>

        <script type="text/javascript">
            (function ($) {
                head.js("<?php echo $this->getViewFileUrl('Magento_Paygate::paygate-authenticate.js') ?>", function () {
                    $('[data-container="release-amounts"]').paygateAuthenticate({
                        partialAuthorizationConfirmationMessage: '<?php echo $this->getPartialAuthorizationConfirmationMessage()?>',
                        cancelConfirmationMessage: '<?php echo $this->getCancelConfirmationMessage() ?>',
                        cancelUrl: '<?php echo $this->getCancelUrl() ?>'
                    });
                });
            })(jQuery);
        </script>
        <span id="cancel-please-wait" class="please-wait" style="display:none">
            <img src="<?php echo $this->getViewFileUrl('images/opc-ajax-loader.gif') ?>" alt="" class="v-middle" /> <?php echo __('Processing...') ?>
        </span>
    <?php endif;?>
</div>
<?php endif;?>
<?php echo $this->getChildHtml('method_form_block') ?>
