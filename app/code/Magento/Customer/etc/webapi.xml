<?xml version="1.0"?>
<!--
/**
 * {license_notice}
 *
 * @copyright   {copyright}
 * @license     {license_link}
 */
-->
<routes xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../app/code/Magento/Webapi/etc/webapi.xsd">
    <!-- Customer Group Service-->
    <route url="/V1/customerGroups/:groupId" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="getGroup"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="getGroups"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups/default/:storeId" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="getDefaultGroup"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups/default" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="getDefaultGroup"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups/:groupId/permissions" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="canDelete"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups/search" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="searchGroups"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups" method="POST">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="saveGroup"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>
    <route url="/V1/customerGroups/:groupId" method="DELETE">
        <service class="Magento\Customer\Service\V1\CustomerGroupServiceInterface" method="deleteGroup"/>
        <resources>
            <resource ref="Magento_Customer::group"/>
        </resources>
    </route>

    <!-- Customer Metadata Service-->
    <route url="/V1/attributeMetadata/customer/attribute/:attributeCode" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerMetadataServiceInterface" method="getAttributeMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customer/form/:formCode" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerMetadataServiceInterface" method="getAttributes"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customer" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerMetadataServiceInterface" method="getAllAttributesMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customer/custom" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerMetadataServiceInterface" method="getCustomAttributesMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>

    <!-- Customer Address Metadata Service-->
    <route url="/V1/attributeMetadata/customerAddress/attribute/:attributeCode" method="GET">
        <service class="Magento\Customer\Service\V1\AddressMetadataServiceInterface" method="getAttributeMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customerAddress/form/:formCode" method="GET">
        <service class="Magento\Customer\Service\V1\AddressMetadataServiceInterface" method="getAttributes"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customerAddress" method="GET">
        <service class="Magento\Customer\Service\V1\AddressMetadataServiceInterface" method="getAllAttributesMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/attributeMetadata/customerAddress/custom" method="GET">
        <service class="Magento\Customer\Service\V1\AddressMetadataServiceInterface" method="getCustomAttributesMetadata"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>

    <!-- Customer Account Service-->
    <route url="/V1/customers/details" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomerDetailsByEmail"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
        <data>
            <parameter name="customerEmail"></parameter>
        </data>
    </route>
    <route url="/V1/customers/details" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="updateCustomerDetailsByEmail"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <!-- TODO: changePassword is a case of SELF. Need to revisit. For now manage is assigned -->
    <!-- TODO: createCustomer, authenticate, validateResetPasswordLinkToken, initiatePasswordReset, resetPassword, resendConfirmation apis
               can be accessed anonymously and need no resources to be assigned. Webapi framework doesn't support support that as yet.
               Adding Magento_Customer::customer temporarily until handling anonymous users is finalized -->
    <route url="/V1/customers" method="POST">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="createCustomer"/>
        <resources>
            <resource ref="anonymous"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="updateCustomer"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/me" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="updateCustomer"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/me/details" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomerDetails"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/details" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomerDetails"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/me" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomer"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomer"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/me/activate" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="activateCustomer"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/activate" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="activateCustomer"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/search" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="searchCustomers"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/search/online" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="searchCustomers"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
        <data>
            <parameter name="online" force="true">TRUE</parameter>
        </data>
    </route>
    <route url="/V1/customers/login" method="POST">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="authenticate"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/me/password" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="changePassword"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/password/resetLinkToken/:resetPasswordLinkToken" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="validateResetPasswordLinkToken"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/password" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="initiatePasswordReset"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId/password" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="resetPassword"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId/confirm" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getConfirmationStatus"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/confirm" method="POST">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="resendConfirmation"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/validate" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="validateCustomerData"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId/permissions/modify" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="canModify"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="getCustomerByEmail"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
        <data>
            <parameter name="customerEmail"></parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/permissions/delete" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="canDelete"/>
        <resources>
            <resource ref="Magento_Customer::customer"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId" method="DELETE">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="deleteCustomer"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers" method="DELETE">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="deleteCustomerByEmail"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
        <data>
            <parameter name="customerEmail"></parameter>
        </data>
    </route>
    <route url="/V1/customers/isEmailAvailable" method="POST">
        <service class="Magento\Customer\Service\V1\CustomerAccountServiceInterface" method="isEmailAvailable"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>

    <!-- Customer Address Service-->
    <route url="/V1/customers/me/addresses" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getAddresses"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/addresses" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getAddresses"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/addresses/:addressId" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getAddress"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/me/billingAddress" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getDefaultBillingAddress"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/billingAddress" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getDefaultBillingAddress"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/me/shippingAddress" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getDefaultShippingAddress"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
    <route url="/V1/customers/:customerId/shippingAddress" method="GET">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="getDefaultShippingAddress"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/addresses/:addressId" method="DELETE">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="deleteAddress"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/:customerId/addresses" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="saveAddresses"/>
        <resources>
            <resource ref="Magento_Customer::manage"/>
        </resources>
    </route>
    <route url="/V1/customers/me/addresses" method="PUT">
        <service class="Magento\Customer\Service\V1\CustomerAddressServiceInterface" method="saveAddresses"/>
        <resources>
            <resource ref="self"/>
        </resources>
        <data>
            <parameter name="customerId" force="true">%customer_id%</parameter>
        </data>
    </route>
</routes>
